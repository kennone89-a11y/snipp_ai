<!doctype html>
<html lang="sv">
<head>
  <style>
/* Review (snabbrecension) */
.review { padding:24px }
.review form { display:grid; gap:12px }
.row-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px }
.input, .select, .textarea {
  width:100%; border:1px solid #444; border-radius:12px;
  background:rgba(255,255,255,.06); color:#fff; padding:10px 12px; outline:none;
}
.textarea { min-height:110px; resize:vertical }
.stars { display:flex; gap:6px; align-items:center }
.star { cursor:pointer; font-size:22px; filter:drop-shadow(0 0 6px rgba(124,92,255,.25)) }
.output-card { background:rgba(0,0,0,.25); border:1px solid #333; border-radius:12px; padding:14px; white-space:pre-wrap }
.actions { display:flex; gap:10px; flex-wrap:wrap }
</style>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snipp â€“ Ljud till Text</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo"></div>
      <div>
        <h1>Snipp â€“ Ljud till Text</h1>
        <div class="subtitle">Spela in eller ladda upp ljud och fÃ¥ text direkt. Drivs av OpenAI.</div>
      </div>
      <span class="spacer"></span>
      <span class="badge" id="status">ğŸŸ¢ Redo</span>
    </div>

    <div class="grid">
      <!-- VÃ¤nster kolumn -->
      <section class="card">
        <h3>Inspelning & uppladdning</h3>

        <div class="row" style="margin-bottom:12px;">
          <button id="recordBtn" class="btn-primary">ğŸ™ï¸ Starta inspelning</button>
          <button id="stopBtn" class="btn-ghost" disabled>â¹ï¸ Stoppa</button>
          <button id="saveLocalBtn" class="btn-safe">ğŸ’¾ Spara textfil</button>

          <span class="spacer"></span>

          <input id="fileInput" type="file"
                 accept=".flac,.m4a,.mp3,.mp4,.mpeg,.mpga,.oga,.ogg,.wav,.webm"
                 style="display:none" />
          <button id="uploadBtn" class="btn-ghost">ğŸ“¤ Ladda upp ljudfil</button>
        </div>

        <audio id="player" controls></audio>

        <h3 style="margin-top:14px;">Transkription</h3>
        <textarea id="result" placeholder="HÃ¤r kommer texten..."></textarea>
        <div class="meta">Transkriptioner sparas pÃ¥ servern och syns under â€œHistorikâ€.</div>
      </section>

      <!-- HÃ¶ger kolumn -->
      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <h3>Historik</h3>
          <button id="refreshBtn" class="btn-ghost">ğŸ”„ Uppdatera</button>
        </div>
        <ul id="history" class="list">
          <li class="item"><span class="item-sub">HÃ¤mtar...</span></li>
        </ul>
      </section>
    </div>
<section id="quickreview" class="section card review">
  <h2>Snabbrecension (podcast/avsnitt)</h2>
  <form id="revForm">
    <div class="row-2">
      <input class="input" id="revTitle"  placeholder="Titel / Avsnittsnamn" required>
      <input class="input" id="revLink"   placeholder="LÃ¤nk (Spotify/YouTube/RSS)">
    </div>
    <div class="row-2">
      <div class="stars" id="revStars" aria-label="Betyg 1â€“5">
        <span class="star" data-v="1">â˜…</span>
        <span class="star" data-v="2">â˜…</span>
        <span class="star" data-v="3">â˜…</span>
        <span class="star" data-v="4">â˜…</span>
        <span class="star" data-v="5">â˜…</span>
        <small id="revScore" style="margin-left:8px;opacity:.8">0/5</small>
      </div>
      <input class="input" id="revAuthor" placeholder="Skapare/Podcastnamn">
    </div>
    <textarea class="textarea" id="revNotes" placeholder="Dina anteckningar (vad handlar avsnittet om?)"></textarea>
    <div class="actions">
      <button type="button" class="btn btn-primary" id="revAi">AI-demo: skriv sammanfattning</button>
      <button type="button" class="btn" id="revCopy">Kopiera recension</button>
      <button type="button" class="btn" id="revDownload">Spara .txt</button>
      <button type="reset"  class="btn">Rensa</button>
    </div>
    <div class="output-card" id="revOut" style="margin-top:10px"></div>
  </form>
</section>

    <div class="footer">Â© Snipp â€¢ Byggd av Kenneth ğŸš€</div>
  </div>

  <!-- Viktigt: extern JS fÃ¶r att fÃ¶lja CSP -->
  <script src="/app.js" defer></script>
  <script>
// ===== Snabbrecension =====
(() => {
  const el = (id)=>document.getElementById(id);
  const title=el('revTitle'), link=el('revLink'), notes=el('revNotes'),
        author=el('revAuthor'), out=el('revOut'), scoreEl=el('revScore');
  let starsValue = 0;

  document.querySelectorAll('#revStars .star').forEach(s=>{
    s.addEventListener('click', ()=>{
      starsValue = +s.dataset.v;
      scoreEl.textContent = `${starsValue}/5`;
      document.querySelectorAll('#revStars .star').forEach(st=>{
        st.style.opacity = (+st.dataset.v <= starsValue) ? '1' : '.35';
      });
    });
  });

  function demoSummary(t){
    const base = (t||'').trim();
    const mood = (base.length%2?'mÃ¶rkare ton':'lÃ¤ttsam ton');
    const take = base ? 'Bygger pÃ¥ dina anteckningar.' : 'Kort demo utan anteckningar.';
    return [
      `Titel: ${title.value||'â€“'}`,
      author.value? `Skapare: ${author.value}` : null,
      link.value? `LÃ¤nk: ${link.value}` : null,
      '',
      'Sammanfattning:',
      base ? base : 'Ingen beskrivning angiven.',
      '',
      `Ton: ${mood}`,
      `Betyg: ${starsValue||'â€“'}/5`,
      '',
      `Kommentar: ${take}`
    ].filter(Boolean).join('\n');
  }

  function buildReview(){ return demoSummary(notes.value); }

  document.getElementById('revAi').addEventListener('click', async ()=>{
    const text = buildReview();
    out.textContent = '';
    for (let i=0;i<text.length;i++){
      out.textContent += text[i];
      await new Promise(r=>setTimeout(r,6));
    }
  });

  document.getElementById('revCopy').addEventListener('click', async ()=>{
    const text = out.textContent || buildReview();
    await navigator.clipboard.writeText(text);
    alert('Recension kopierad âœ…');
  });

  document.getElementById('revDownload').addEventListener('click', ()=>{
    const text = out.textContent || buildReview();
    const blob = new Blob([text], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (title.value||'recension') + '.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  });
})();
</script>

</body>
</html>
