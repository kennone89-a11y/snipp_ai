<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R√∂strecessioner (MVP)</title>
  <meta name="description" content="Spela in r√∂st, skriv kort text och spara dina recensioner. Enkel MVP f√∂r r√∂strecessioner." />
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#080d12" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark light; }
    html { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    body { background:#080d12; color:#e6eef8; }
    .glass { backdrop-filter: blur(8px); background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); border: 1px solid rgba(255,255,255,0.12); }
    .card { border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.18); }
    button { transition: .15s ease; }
    .tagchip { border:1px solid rgba(255,255,255,.14); }
    .tagchip.active { background:#1dc273; border-color:#38b26f; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100">
  <main class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">R√∂strecessioner</h1>
    <p class="mt-2 text-neutral-300">Spela in din r√∂st, l√§gg till taggar och spara. Perfekt f√∂r poddar, filmer och ljudb√∂cker.</p>

    <section id="recorder" class="max-w-6xl mx-auto px-4 pb-12">
      <h2 class="text-2xl font-bold">üéôÔ∏è Spela in & ladda upp</h2>

      <div class="mt-4 grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 glass card p-6">
          <div class="flex items-center gap-3 flex-wrap">
            <button id="btnStart" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 font-semibold" aria-label="Starta">Spela in</button>
            <button id="btnStop" class="px-4 py-2 rounded-lg bg-fuchsia-600 hover:bg-fuchsia-500 font-semibold" aria-label="Stoppa" disabled>Stoppa</button>
            <button id="btnUpload" class="px-4 py-2 rounded-lg bg-neutral-800 hover:bg-neutral-700 font-semibold disabled:opacity-50" disabled>Ladda upp</button>
            <span id="recReady" class="text-xs px-2 py-1 rounded bg-emerald-700/30 border border-emerald-700 hidden">Inspelning klar ‚úî</span>
            <span id="time" class="text-sm text-neutral-300">00:00</span>
            <label class="ml-2 inline-flex items-center gap-2 text-sm text-neutral-300 select-none">
              <input id="procToggle" type="checkbox" class="accent-emerald-500" />
              <span>Trim tystnad + normalisera (WAV)</span>
            </label>
          </div>
          <audio id="player" class="w-full mt-4 rounded-lg bg-neutral-900 border border-neutral-800" controls></audio>
          <canvas id="wave" class="mt-3 h-28 w-full rounded-lg bg-neutral-900 border border-neutral-800"></canvas>
          <div class="mt-3 flex gap-3">
            <a id="downloadLink" class="px-3 py-2 rounded-lg bg-neutral-800 hover:bg-neutral-700 text-sm hidden">Ladda ned</a>
            <button id="btnUseInNew" class="px-3 py-2 rounded-lg bg-neutral-800 hover:bg-neutral-700 text-sm hidden">Anv√§nd i ny recension</button>
          </div>
          <p id="status" class="mt-3 text-sm text-neutral-400"></p>
        </div>
        <aside class="glass card p-6">
          <h3 class="font-semibold mb-3">Tips</h3>
          <ul class="list-disc pl-5 text-neutral-300 space-y-1">
            <li>H√•ll mikrofonen n√§ra.</li>
            <li>St√§ng av notiser under inspelning.</li>
            <li>Max 5 min rekommenderas.</li>
          </ul>
        </aside>
      </div>

      <div class="mt-6 glass card p-4">
        <details>
          <summary class="cursor-pointer font-semibold">üìÅ Ladda upp fil</summary>
          <div class="mt-3"><input id="fileInput" type="file" accept="audio/*" class="block" /></div>
        </details>
      </div>

      <div class="mt-4 glass card p-4">
        <h3 class="font-semibold">Resultat</h3>
        <p id="result" class="text-sm text-neutral-400">Ingen uppladdning gjord √§n.</p>
      </div>

      <div class="mt-4 glass card p-4">
        <h3 class="font-semibold">Senaste uppladdningar</h3>
        <ul id="history" class="mt-2 text-sm text-neutral-300"></ul>
      </div>
    </section>
  </main>

 <!-- Ladda Supabase + initiera global klient (SB1) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<!-- BYT DINA V√ÑRDEN H√ÑR -->
<script>
  // 1) Klistra in DIN riktiga URL och ANON KEY
  const SUPABASE_URL = "https://DIN-PROJEKTID.supabase.co";
  const SUPABASE_ANON_KEY = `DIN_MEGA_L√ÖNGA_ANON_PUBLIC_KEY_H√ÑR`
    .trim()
    .replace(/\s/g, "");

  // 2) Starta Supabase ‚Äì men l√•t inte fel stoppa resten av sidan
  try {
    window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log("sb ready?", !!window.sb);
  } catch (e) {
    console.error("Supabase init failed:", e);
    // Minimal stub s√• att app.js inte kraschar
    window.sb = {
      storage: { from() { return { upload: async()=>({ error:new Error("offline") }),
                                   getPublicUrl:()=>({ data:{ publicUrl:"" } }) }; } }
    };
  }

  // 3) Aktivera knappar oavsett vad som h√§nder ovan
  document.addEventListener('DOMContentLoaded', () => {
    ['btnStart','btnStop','btnUpload'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.removeAttribute('disabled');
    });
    console.log('buttons enabled');
  });
</script>

</script>

<script src="app.js?v=6"></script>
<script>
  // Tvinga p√• knapparna ifall n√•got tidigare script kraschade
  document.getElementById('btnStart')?.removeAttribute('disabled');
  document.getElementById('btnStop')?.removeAttribute('disabled');
  document.getElementById('btnUpload')?.removeAttribute('disabled');
</script>

</body>
</html>
